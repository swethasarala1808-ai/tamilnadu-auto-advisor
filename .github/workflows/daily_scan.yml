name: Daily Stock Scan

on:
  schedule:
    - cron: "0 3 * * *"   # 3:00 UTC = 8:30 AM IST
  workflow_dispatch:

jobs:
  scan:
    runs-on: ubuntu-latest
    timeout-minutes: 180   # allow long runs if scanning full market

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install yfinance pandas numpy requests

    # Optionally refresh tickers live from NSE/BSE (uncomment to enable)
    - name: Fetch latest tickers (optional)
      run: |
        # Uncomment the next line if you want to refresh tickers each run (may fail if endpoints block)
        # python fetch_tickers.py
        echo "Skipping fetch_tickers.py by default. Run it manually if needed."

    - name: Run scanner
      run: |
        python scan.py

    - name: Commit data files
      run: |
        mkdir -p data
        git config --global user.email "bot@example.com"
        git config --global user.name "Swetha-Auto"
        git add data/today_pick.json data/candidates.csv || true
        git commit -m "Daily pick update" || echo "No changes to commit"
        git push
